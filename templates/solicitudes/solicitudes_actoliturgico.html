{% extends "index.html" %}
{% block title %}Gestión solicitudes{% endblock %}
{% block cuerpo %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>

<style>
    .formulario_imagenes {
        width: 100%;
        height: auto;
        max-height: 90vh;
        display: block;
        margin: 0 auto;

    }

    #myModal {
        background: rgba(0, 0, 0, 0.5);
    }

    body {
        background-color: #f8f9fa;
    }

    .payment-form {
        max-width: 600px;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .form-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .qr-code img {
        width: 50%;
        height: 100%;
        object-fit: cover;
    }

    #imagen_qr {
        width: 250px;
        height: auto;
    }
</style>

<main class="ms-5">
    <h1 class="titulo-gestion">GESTIÓN DE SOLICITUDES DE ACTO LITÚRGICO</h1>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="solicitudes-tab" data-bs-toggle="tab" data-bs-target="#solicitudes" type="button" role="tab" aria-controls="solicitudes" aria-selected="true">
                <i class="bi bi-envelope-paper-fill"></i> Registro de solicitudes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button   class="nav-link" id="requisitos-tab" data-bs-toggle="tab" data-bs-target="#requisitos" type="button" role="tab" aria-controls="requisitos" aria-selected="false">
                <i class="bi bi-list-check"></i> Solicitudes
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pagos-tab" data-bs-toggle="tab" data-bs-target="#pagos" type="button" role="tab" aria-controls="pagos" aria-selected="false">
                Pagos
            </button>
        </li>
    </ul>

    <div class="tab-content mt-4">
        <!-- Tab 1: Registro de solicitudes -->
        <div class="tab-pane fade show active" id="solicitudes" role="tabpanel" aria-labelledby="solicitudes-tab">
            <label for="" class="">Seleccione un acto:</label>
            <div class="d-flex" class="mt-5" id="gg">
                <select name="acto_seleccionado" id="acto_seleccionado" class="form-select w-25" onchange="verificar()">
                    <option value="" >
                    </option>
                    {% for actos in lista_actos %}
                    <option value="{{ actos[0]}}">
                        {{actos[1]}}
                    </option>
                    {% endfor %}
                </select>
            </div>
    
        </div>
    
        <!-- Tab 2: Requisitos -->
        <div class="tab-pane fade" id="requisitos" role="tabpanel" aria-labelledby="requisitos-tab">
            <!----- Tabla solicitudes ------>
            <div class="mt-3" id="aaa">
                <h6><strong>Tabla solicitudes:</strong></h6>
                <!-- Contenedor con scroll -->
                <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                    <table class="table" id="soli_tab">
                        <thead >
                            <tr>
                                <th class="text-center">ID</th>
                                <th class="text-center">Fecha</th>
                                <th class="text-center">Sede</th>
                                <th class="text-center">Acto litúrgico</th>
                                <th class="text-center">Feligres responsable</th>
                                <th class="text-center">Opciones</th>
                            </tr>
                        </thead>
                        <tbody id="solicitud">
                        </tbody>
                    </table>
                </div> 
            </div>
        </div>
    
        <!-- Tab 3: Pagos -->
        <div class="tab-pane fade" id="pagos" role="tabpanel" aria-labelledby="pagos-tab">
            <h3>Método de Pago</h3>
            <div class="d-flex justify-content-around">
                <div>
                    <img src="https://via.placeholder.com/80" alt="Yape" class="img-fluid">
                    <p class="text-center">Yape</p>
                </div>
                <div>
                    <img src="https://via.placeholder.com/80" alt="Plin" class="img-fluid">
                    <p class="text-center">Plin</p>
                </div>
                <div>
                    <img src="https://via.placeholder.com/80" alt="Tarjeta" class="img-fluid">
                    <p class="text-center">Tarjeta</p>
                </div>
            </div>
        </div>
    
        <!-- Tab 4: Asistencias -->
        <div class="tab-pane fade" id="asistencias" role="tabpanel" aria-labelledby="asistencias-tab">
            <h3>Asistencias</h3>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tema</th>
                            <th>Fecha</th>
                            <th>Nombre</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Preparación Bautizo</td>
                            <td>2024-11-20</td>
                            <td>Juan Pérez</td>
                            <td>Presente</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    

</main>



<main class="ms-5">
    <!---------<button class="btn btn-primary"><i class="bi bi-plus-circle-fill me-2"></i>Nueva Solicitud</button>
    <hr>-------------->
    <div class="row" id="div_sol">
        <!-- Contenedor para pestañas -->
        <div class="tab-content mt-1">
            <div class="col-12 mt-3">
                <h6><strong>Acto litúrgico:</strong></h6>
                <div class="d-flex">
                    <select name="acto_seleccionado" id="acto_seleccionado" class="form-select w-25" onchange="verificar()">
                        <option value="">
                            ----Seleccione un acto litúrgico----
                        </option>
                        {% for actos in lista_actos %}
                        <option value="{{ actos[0]}}">
                            {{actos[1]}}
                        </option>
                        {% endfor %}
                    </select>

                </div>
                <!---------   Esta es la tabla donde se muestran los requisitos    ----------->
                <div class="accordion mt-3" id="accordionRequisitos" >
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingRequisito">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#requi_actos" aria-expanded="true" aria-controls="requi_actos">
                                Requisitos del Acto
                            </button>
                        </h2>
                        <div id="requi_actos" class="accordion-collapse collapse show"
                            aria-labelledby="headingRequisito" data-bs-parent="#accordionRequisitos">
                            <div class="accordion-body">
                                <form id="formulario_solicitud" enctype="multipart/form-data">
                                    <table class="table mt-1">
                                        <thead>
                                            <tr>
                                                <th>
                                                    Requisito
                                                </th>
                                                <th>
                                                    Tipo
                                                </th>
                                                <th>
                                                    <input type="checkbox" id="estado_general"
                                                        onchange="estado_generales()">
                                                    <label for="estado_general">Estado</label>
                                                </th>
                                                <th>
                                                    Opciones
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="datos_solicitud">
                                            <!-- Aquí irán las filas dinámicas de la tabla -->
                                        </tbody>
                                    </table>
                                    <div>
                                        <button type="submit" id="registrar" onclick="enviar_datos(event)"
                                            class="btn btn-primary">Registrar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-2 d-none" id="contenido_calendario_celebracion">
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-danger " onclick="exportarTablaPDF()"><i
                                class="bi bi-file-pdf-fill"></i></button>
                        <button type="button" class="btn btn-primary " onclick="retornar()"><i
                                class="bi bi-arrow-left-circle-fill"></i></button>
                    </div>
                    <div id="tablapdf" class="mt-3">
                        <table id="miTabla" class="table">
                            <thead>
                                <tr>
                                    <th>
                                       Tema 
                                    </th>
                                    <th>
                                        Fecha
                                    </th>
                                    <th>
                                        Hora inicio
                                    </th>
                                    <th>
                                        Hora fin
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="cu_tablapdf">
        
                            </tbody>
                        </table>
                    </div>
                </div>

                

            </div>
        </div>
    </div>


    <div class="container d-none" id="pago">
        <div class="payment-form">
            <div class="form-header">
                <h2>Método de pago</h2>
                <h2><strong id="metodo">efectivo</strong></h2>
            </div>
            <div class="qr-code d-inline-flex">
                <div class="col-3 me-2 btn" onclick="mostrar_img('yape')">
                    <img src="/static/img/yape.png" class="card-img-top" alt="...">
                </div>
                <div class="col-3 me-2 btn" onclick="mostrar_img('plin')">
                    <img src="/static/img/plin.jpg" class="card-img-top" alt="...">
                </div>
                <div class="col-3 me-2 btn" onclick="mostrar_img('tarjeta')">
                    <img src="/static/img/tarjeta.webp" class="card-img-top" alt="...">
                </div>
                <div class="col-3 me-5 btn" onclick="mostrar_img('efecto')">
                    <img src="/static/img/efectivo.jpg" class="card-img-top" alt="...">
                </div>
            </div>

            <div class="d-flex  mt-4">
                <img class="mx-auto" id="imagen_qr" alt="">
            </div>
            <form id="paguitos" enctype="multipart/form-data">
                <div>
                    <label for="responsable">Seleccione el feligres responsable</label>
                    <select name="responsable" id="responsable" class="form-select" onchange="precio()" required>
                    </select>
                </div>

                <div class="form-group mt-2">
                    <label for="amount">Monto a Pagar</label>
                    <input type="text" class="form-control" id="amount" placeholder="Ingrese el monto" disabled>
                </div>

                <button id="pagos" type="button" class="btn btn-primary btn-block mt-2 w-100"
                    onclick="grabar_solicitud()" disabled>Confirmar Pago</button>
            </form>
        </div>
    </div>



    <!-- MODAL PARA MOSTRAR FOTO -->
    <div class="modal" tabindex="-1" id="myModal">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-body" id="modal_contenido">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" tabindex="-1" id="modal_asistencia">
        <div class="modal-dialog" style="max-width: none ; width: 90%">
            <div class="modal-content" style="height: 45vw;">
                <div class="modal-body overflow-y-scroll" id="modal_asistencia">
                    <div class="modal-header">
                        <h5 class="modal-title " id="exampleModalLabel">Asistencias de los feligreses a: <span id="uno"> </span>, <br> Número de solicitud: <span id="dos"> </span> </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                    <div class="modal-body">
                    <table class="table table-sm">
                        <thead id="cu_asistencias">
                            <tr class="table-primary">
                                <th class="text-center">ID</th>
                                <th class="text-center">Tema</th>
                                <th class="text-center">Fecha</th>
                                <th class="text-center">Rol</th>
                                <th class="text-center">Dni</th>
                                <th class="text-center">Nombre</th>
                                <th class="text-center">
                                    <label>Estado</label>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="cu_cuerpo">

                        </tbody>

                    </table>
                </div>
                </div>
            </div>
        </div>
    </div>

</main>
<!------<script src="/static/js/solicitudes.js"></script> !------>
<script src="/static/js/solicitudes2.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% endblock %}