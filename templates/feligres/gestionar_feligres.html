{% extends "index.html" %}
{% block title %}Gestión de Feligreses{% endblock %}
{% block cuerpo %}
<style>
    #feligresesTable {
        table-layout: auto;
        width: 100%;
    }

    #feligresesTable th,
    #feligresesTable td {
        white-space: nowrap;
        /* Evita que el contenido se ajuste en varias líneas */
        text-align: center;
        padding: 8px;
    }
</style>

<div class="container mt-4">
    <h1 class="titulo-gestion">Gestión de Feligreses</h1>

    <div>
        <table id="feligresesTable" class="table table-hover table-striped">
            <thead>
                <tr>
                    <th style="vertical-align: middle; text-align: center;">DNI</th>
                    <th style="vertical-align: middle; text-align: center;">Nombres completos</th>
                    <th style="vertical-align: middle; text-align: center;">Fecha de Nacimiento</th>
                    <th style="vertical-align: middle; text-align: center;">Estado Civil</th>
                    <th style="vertical-align: middle; text-align: center;">Sexo</th>
                    <th style="vertical-align: middle; text-align: center;">Sede</th>
                    <th style="vertical-align: middle; text-align: center;">Correo electronico</th>
                    <th style="vertical-align: middle; text-align: center; width: 200px;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for feligres in feligreses %}
                <tr>
                    <td class="text-center">{{ feligres[0] }}</td>
                    <td class="text-start">{{ feligres[1] }}, {{feligres[2]}}</td>
                    <td>{{ feligres[3] }}</td>
                    <td>
                        {% if feligres[4] == 's' or feligres[4] == 'S' %}
                        Soltero
                        {% elif feligres[4] == 'c' or feligres[4] == 'C' %}
                        Casado
                        {% elif feligres[4] == 'v' or feligres[4] == 'V' %}
                        Viudo
                        {% elif feligres[4] == 'd' or feligres[4] == 'D' %}
                        Divorciado
                        {% else %}
                        Desconocido
                        {% endif %}
                    </td>
                    <td>
                        {% if feligres[5] == 'm' or feligres[5] == 'M' %}
                        Masculino
                        {% elif feligres[5] == 'f' or feligres[5] == 'F' %}
                        Femenino
                        {% else %}
                        Desconocido
                        {% endif %}
                    </td>

                    <td class="text-start">{{ feligres[7] }}</td>
                    <td class="text-start">{{ feligres[8] }}</td>

                    <td class="text-center">

                        <button class="btn btn-primary btn-sm" title="Ver"
                            onclick="openModal('view', '{{ feligres[0] }}', '{{ feligres[1] }}', '{{ feligres[2] }}', '{{ feligres[3] }}', '{{ feligres[4] }}', '{{ feligres[5] }}', '{{ feligres[6] }}', '{{ feligres[8] }}')">
                            <i class="fas fa-eye"></i>
                        </button>

                        <button class="btn btn-warning btn-sm" title="Editar"
                            onclick="openModal('edit', '{{ feligres[0] }}', '{{ feligres[1] }}', '{{ feligres[2] }}', '{{ feligres[3] }}', '{{ feligres[4] }}', '{{ feligres[5] }}', '{{ feligres[6] }}', '{{ feligres[8] }}')">
                            <i class="fas fa-edit"></i>
                        </button>

                        <button type="button" class="btn btn-danger btn-sm" title="Eliminar"
                            onclick="eliminarFeligres('{{ feligres[0] }}')">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para Agregar/Ver/Editar Feligres -->
<div class="modal fade" id="feligresModal" tabindex="-1" aria-labelledby="feligresModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="feligresForm" action="" method="POST">
                <div class="modal-header">
                    <h5 class="modal-title" id="feligresModalLabel">Modal Title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="dni" class="form-label">DNI</label>
                        <input type="text" class="form-control" id="dni" name="dni" required maxlength="8"
                            pattern="^\d{8}$" title="El DNI debe ser un número de 8 dígitos">
                    </div>
                    <div class="mb-3">
                        <label for="apellidos" class="form-label">Apellidos</label>
                        <input type="text" class="form-control" id="apellidos" name="apellidos" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombres" class="form-label">Nombres</label>
                        <input type="text" class="form-control" id="nombres" name="nombres" required>
                    </div>
                    <div class="mb-3">
                        <label for="fecha_nacimiento" class="form-label">Fecha de nacimiento</label>
                        <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required
                            max="{{ today }}">
                    </div>
                    <div class="mb-3">
                        <label for="estado_civil" class="form-label">Estado Civil</label>
                        <select class="form-select" id="estado_civil" name="estado_civil" required>
                            <option value="S">Soltero</option>
                            <option value="C">Casado</option>
                            <option value="V">Viudo</option>
                            <option value="D">Divorciado</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="sexo" class="form-label">Sexo</label>
                        <select class="form-select" id="sexo" name="sexo" required>
                            <option value="m">Masculino</option>
                            <option value="f">Femenino</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="sede" class="form-label">Sede</label>
                        <select class="form-select" id="id_sede" name="id_sede" required>
                            <option>Seleccione una sede</option>
                            {% for sede in sedes %}
                            <option value="{{ sede[0] }}">{{ sede[1] }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="correo" class="form-label">Correo electrónico</label>
                        <input type="email" class="form-control" id="email" name="correo">
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary" id="saveChanges">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="/static/js/feligres.js"></script>

<script type="text/javascript">
    const urlInsertarFeligres = "{{ url_for('procesar_insertar_feligres') }}";
    const urlActualizarFeligres = "{{ url_for('procesar_actualizar_feligres') }}";
    const urlEliminarFeligres = "{{ url_for('procesar_eliminar_feligres') }}";
</script>

<script>
    var today = new Date().toISOString().split('T')[0];
    document.getElementById('fecha_nacimiento').setAttribute('max', today);
</script>

{% endblock %}